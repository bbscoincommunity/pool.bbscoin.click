<style>
    .marketFooter{
        font-size: 10px;
        opacity: 0.6;
    }
    #networkLastReward{
        text-transform: uppercase;
    }
    #lastHash{
        font-family: 'Inconsolata', monospace;
        font-size: 0.8em;
    }
    #poolDonations{
        font-size: 0.75em;
    }
    #miningProfitCalc{
        margin: 35px 0;
    }
    #calcHashDropdown{
        border-radius: 0;
        border-left: 0;
        border-right: 0;
    }
    #calcHashHolder{
        width: 590px;
        max-width: 100%;
    }
    #calcHashRate{
        z-index: inherit;
        font-family: 'Inconsolata', monospace;
    }
    #calcHashAmount{
        font-family: 'Inconsolata', monospace;
    }
    #calcHashResultsHolder{
        min-width: 145px;
        max-width: 145px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    #yourStatsInput{
        z-index: inherit;
        font-family: 'Inconsolata', monospace;
    }
    #yourAddressDisplay > span {
        font-family: 'Inconsolata', monospace;
    }
    #lookUp > span:nth-child(2){
        display: none;
    }
    .yourStats{
        display: none;
    }
    #yourAddressDisplay{
        display: inline-block;
        max-width: 100%;
        overflow: hidden;
        text-overflow: ellipsis;
        vertical-align: middle;
        font-family: 'Inconsolata', monospace;
        font-size: 0.9em;
    }
    #addressError{
        color: red;
    }


    #payments_rows > tr > td{
        vertical-align: middle;
        font-family: 'Inconsolata', monospace;
        font-size: 0.95em;
        text-align: center;
    }
    #payments_rows > tr > td:nth-child(2){
        text-align: left;
    }

</style>

<div id="siteInfo" style="color:tomato">
    <p style="font-size: 25px">
        <!-- b>⚠️ BBSCoin will upgrade at height 205,530. ⚠️ </b><br -->
        <!-- b>⚠️ It has been decided that this will be a community donation pool, please do not use this pool yet, it will have a minimum pool fee of 5% vs 0.5% on regular pool and fee would be used for community funds, will be testing for user supplied donation rate(just like in the static difficulty rate) for those who want to make higher donations. Will be doing cached stats for 30 seconds to lessen the load on node and leave it to the mining. Thank you. ⚠️ </b><br / -->
        <p><b>PoW is still CryptoNight Lite v7.</b></p>
    </p>
    <p>
        Please make sure your wallet and daemon are <b>v6.0.x</b> to prevent synchronization issues. <a href="http://www.bbscoin.click/download">http://www.bbscoin.click/download</a> <br>
        <!-- Or use our convenient web wallet: <a href="https://bbs.money">https://bbs.money</a> <br -->
    </p>
</div>

<div class="row">
    <div id="ticker" class="col-md-6 stats hidden">
        <h3 id="marketHeader">Markets</h3>
        <table>
            <thead style="background-color:deepskyblue;font-weight:bold;padding:10px 1px 10px 1px;">
                <tr>
                    <td>Exchange</td>
                    <td>Pair</td>
                    <!-- <td>Volume</td> -->
                    <td>Volume</td>
                    <td>Price</td>
                </tr>
            </thead>
            <tbody>
                <tr class="tradeogre-btc hidden">
                    <td>TradeOgre</td>
                    <td><a target="_blank" href="https://tradeogre.com/exchange/BTC-BBS">BBS/BTC</a></td>
                    <!-- <td><span id="volume_bbs_tradeogre">N / A</span></td> -->
                    <td><span id="volume_btc_tradeogre"></span></td>
                    <td><span id="volume_btcusd_tradeogre"></span></td>
                </tr>
                <tr class="tradeogre-ltc hidden">
                    <td>TradeOgre</td>
                    <td><a target="_blank" href="https://tradeogre.com/exchange/LTC-BBS">BBS/LTC</a></td>
                    <!-- <td><span id="volume_bbs_tradeogre">N / A</span></td> -->
                    <td><span id="volume_ltc_tradeogre"></span></td>
                    <td><span id="volume_ltcusd_tradeogre"></span></td>
                </tr>
                <tr class="crex24 hidden">
                    <td>Crex24</td>
                    <td><a target="_blank" href="https://crex24.com/exchange/BBS-BTC">BBS/BTC</a></td>
                    <!-- <td><span id="volume_bbs_crex24"></span></td> -->
                    <td><span id="volume_btc_crex24"></span></td>
                    <td><span id="volume_usd_crex24"></span></td>
                </tr>
                <tr class="btrx hidden">
                    <td>Bololex</td>
                    <td><a target="_blank" href="https://bololex.com/trading?symbol=BBST-TRX">BBST/TRX</a></td>
                    <!-- <td><span id="volume_bbs_btrx"></span></td> -->
                    <td><span id="volume_trx_btrx"></span></td>
                    <td><span id="volume_usd_btrx"></span></td>
                </tr>
                <tr class="busdt hidden">
                    <td>Bololex</td>
                    <td><a target="_blank" href="https://bololex.com/trading?symbol=BBST-USDT">BBST/USDT</a></td>
                    <!-- <td><span id="volume_bbs_busdt"></span></td> -->
                    <td><span id="volume_usdt_busdt"></span></td>
                    <td><span id="volume_usd_busdt"></span></td>
                </tr>
                <tr class="wbbs hidden">
                    <td>JustSwap</td>
                    <td><a target="_blank" href="https://justswap.io/#/scan/detail/trx/TB3CjdHfkraU7MJLSQESYPY4U2CMKXi3LB">WBBS/TRX</a></td>
                    <!-- <td><span id="volume_bbs_wbbs"></span></td> -->
                    <td><span id="volume_trx_wbbs"></span></td>
                    <td><span id="volume_usd_wbbs"></span></td>
                </tr>
                <tr class="alex-xmr hidden">
                    <td>altex.exchange</td>
                    <td><a target="_blank" href="https://altex.exchange/markets&amp;pair=XMR_BBS">BBS/XMR</a></td>
                    <!-- <td><span id="volume_xmrbbs_altex"></span></td> -->
                    <td><span id="volume_xmr_altex"></span></td>
                    <td><span id="volume_xmrusd_altex"></span></td>
                </tr>
                <tr class="alex-btc hidden">
                    <td>altex.exchange</td>
                    <td><a target="_blank" href="https://altex.exchange/markets&amp;pair=BTC_BBS">BBS/BTC</a></td>
                    <!-- <td><span id="volume_btcbbs_altex"></span></td> -->
                    <td><span id="volume_btc_altex"></span></td>
                    <td><span id="volume_btcusd_altex"></span></td>
                </tr>
                <tr class="alex-ltc hidden">
                    <td>altex.exchange</td>
                    <td><a target="_blank" href="https://altex.exchange/markets&amp;pair=LTC_BBS">BBS/LTC</a></td>
                    <!-- <td><span id="volume_ltcbbs_altex"></span></td> -->
                    <td><span id="volume_ltc_altex"></span></td>
                    <td><span id="volume_ltcusd_altex"></span></td>
                </tr>
                <tr class="alex-doge hidden">
                    <td>altex.exchange</td>
                    <td><a target="_blank" href="https://altex.exchange/markets&amp;pair=DOGE_BBS">BBS/DOGE</a></td>
                    <!-- <td><span id="volume_ltcbbs_altex"></span></td> -->
                    <td><span id="volume_doge_altex"></span></td>
                    <td><span id="volume_dogeusd_altex"></span></td>
                </tr>
                <tr>
                    <td><span style="font-size: 11px">Total volume in 24 hours: $<span id="totalVolume"></span></span></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
            </tbody>
        </table>
        
    </div>
</div>
</div>

<div class="row">
    <div class="col-md-3 stats">
        <h3>Network</h3>
        <div>Hash Rate: <span id="networkHashrate"></span></div>
        <div>Block Found: <span id="networkLastBlockFound"></span></div>
        <div>Difficulty: <span id="networkDifficulty"></span></div>
        <div>Blockchain Height: <span id="blockchainHeight"></span></div>
        <div>Last Reward: <span id="networkLastReward"></span></div>
        <div>Last Hash: <a id="lastHash" target="_blank"></a></div>
    </div>

    <div class="col-md-3 stats">
        <h3>Our Pool</h3>
        <div>Hash Rate: <span id="poolHashrate"></span></div>
        <div>Block Found: <span id="poolLastBlockFound"></span></div>
        <div>Connected Miners: <span id="poolMiners"></span></div>
        <div id="donations">Donations: <span id="poolDonations"></span></div>
        <div>Total Pool Fee: <span id="poolFee"></span></div>
        <div>Block Found Every: <span id="blockSolvedTime"></span> (est.)</div>
    </div>


<!-- <hr> -->

<div class="row chartsPoolStat">
    <div class="col-sm-2 chartWrap">
        <h4>Hash/USD <span data-toggle="tooltip" data-placement="top" data-original-title="Reward * Rate / Difficulty"><i class="fa fa-question-circle"></i></span></h4>
        <div id="chartHashUsd" data-chart="profit">
            <div class="chart"></div>
            <!-- <p class="text-center" id="cur_profit">-</p> -->
        </div>
    </div>
    <div class="col-sm-20 chartWrap">
        <h4>Price in USD</h4>
        <div id="chartPriceUsd" data-chart="price">
            <div class="chart"></div>
            <!-- <p class="text-center" id="cur_price">-</p> -->
        </div>
    </div>
    <div class="col-sm-20 chartWrap">
        <h4>Difficulty</h4>
        <div id="chartDifficulty" data-chart="diff">
            <div class="chart"></div>
            <!-- <p class="text-center" id="cur_diff">-</p> -->
        </div>
    </div>
    <div class="col-sm-20 chartWrap">
        <h4>Hashrate</h4>
        <div id="chartHashrate" data-chart="hashrate">
            <div class="chart"></div>
            <!-- <p class="text-center" id="cur_hashrate">-</p> -->
        </div>        
    </div>
    <div class="col-sm-20 chartWrap">        
        <h4>Workers</h4>
        <div id="chartWorkers" data-chart="workers">
            <div class="chart"></div>
            <!-- <p class="text-center" id="cur_workers">-</p> -->
        </div> 
    </div>    

    <script>
        var currencyGraphStat = {
            type: 'line',
            width: '100%',
            height: '75',
            lineColor: '#57B8FF',
            fillColor: '#94D1FF',
            spotColor: null,
            minSpotColor: null,
            maxSpotColor: null,
            highlightLineColor: '#57B8FF',
            spotRadius: 2,        
            chartRangeMin: 0,
            drawNormalOnTop: false,
            tooltipFormat: '<b>{{y}}</b>, {{offset:names}}'
        };

        var userGraphStat = {
	        hashrate: {
		        type: 'line',
		        width: '100%',
		        height: '180',
		        lineColor: '#57B8FF',
		        fillColor: '#94D1FF',
		        spotColor: null,
		        minSpotColor: null,
		        maxSpotColor: null,
		        highlightLineColor: '#57B8FF',
		        spotRadius: 2,
		        drawNormalOnTop: false,
		        chartRangeMin: 0,
		        tooltipFormat: '<b>{{y}}</b>, {{offset:names}}'
	        },
	        payments: {
		        type: 'line',
		        width: '100%',
		        height: '180',
		        lineColor: '#57B8FF',
		        fillColor: '#94D1FF',
		        spotColor: null,
		        minSpotColor: null,
		        maxSpotColor: null,
		        highlightLineColor: '#57B8FF',
		        spotRadius: 2,
		        drawNormalOnTop: false,
		        chartRangeMin: 0,
		        tooltipFormat: '<b>{{y}}</b>, {{offset:names}}'
	        }
        };

        $(function() {
            $('[data-toggle="tooltip"]').tooltip();
        });
    </script>

</div>

<!-- <hr> -->

<div id="miningProfitCalc">
    <h3>Estimate Mining Profits</h3>
    <div id="calcHashHolder">
        <div class="input-group">
            <input type="number" class="form-control" id="calcHashRate" placeholder="Enter Your Hash Rate">
            <div class="input-group-btn">
                <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" id="calcHashDropdown">
                    <span id="calcHashUnit" data-mul="1">KH/s</span> <span class="caret"></span>
                </button>
                <ul class="dropdown-menu dropdown-menu-right" role="menu" id="calcHashUnits">
                    <li><a href="#" data-mul="0">H/s</a></li>
                    <li><a href="#" data-mul="1">KH/s</a></li>
                    <li><a href="#" data-mul="2">MH/s</a></li>
                </ul>
            </div>
            <span class="input-group-addon">=</span>
            <span class="input-group-addon" id="calcHashResultsHolder"><span id="calcHashAmount"></span> <span id="calcHashSymbol"></span>/day</span>
        </div>
    </div>
</div>

<hr>

<div class="stats">
    <h3>Your Stats & Payment History</h3>

    <div class="input-group">
        <input class="form-control" id="yourStatsInput" type="text" placeholder="Enter Your Address">
        <span class="input-group-btn"><button class="btn btn-default" type="button" id="lookUp">
            <span><i class="fa fa-search"></i> Lookup</span>
            <span><i class="fa fa-refresh fa-spin"></i> Searching...</span>
        </button></span>
    </div>

    <div class="row">
        <div class="col-sm-4 stats">
            <div id="addressError"></div>
            <!-- <div class="yourStats"><i class="fa fa-key"></i> Address: <span id="yourAddressDisplay"></span></div> -->
            <div class="yourStats"><i class="fa fa-bank"></i> Pending Balance: <span id="yourPendingBalance"></span></div>
            <div class="yourStats"><i class="fa fa-money"></i> Total Paid: <span id="yourPaid"></span></div>
            <div class="yourStats"><i class="fa fa-clock-o"></i> Last Share Submitted: <span id="yourLastShare"></span></div>
            <div class="yourStats"><i class="fa fa-tachometer"></i> Hash Rate: <span id="yourHashrateHolder"></span></div>
            <div class="yourStats"><i class="fa fa-cloud-upload"></i> Total Hashes Submitted: <span id="yourHashes"></span></div>
        </div>
        <div class="col-sm-4">            
            <div class="userChart" data-chart="user_hashrate">
                <h4>Hash Rate</h4>
                <div class="chart">
                    
                </div>                
            </div>
        </div> 
        <div class="col-sm-4">
            <div class="userChart" data-chart="user_payments">
                <h4>Payments</h4>
                <div class="chart">
                    
                </div> 
            </div>
        </div>       
    </div>
    

    <br class="yourStats">

    <h4 class="yourStats">Payments</h4>
    <div class="yourStats table-responsive">
        <table class="table table-striped">
            <thead>
            <tr>
                <th><i class="fa fa-clock-o"></i> Time Sent</th>
                <th><i class="fa fa-paw"></i> Transaction Hash</th>
                <th><i class="fa fa-money"></i> Amount</th>
                <th><i class="fa fa-sitemap"></i> Mixin</th>
            </tr>
            </thead>
            <tbody id="payments_rows">

            </tbody>
        </table>
    </div>
    <p class="yourStats text-center">
        <button type="button" class="btn btn-default" id="loadMorePayments">Load More</button>
    </p>

</div>

<script>


    currentPage = {
        destroy: function(){
            $('#networkLastBlockFound,#poolLastBlockFound,#yourLastShare,#marketLastUpdated').timeago('dispose');
            if (xhrAddressPoll) xhrAddressPoll.abort();
            if (addressTimeout) clearTimeout(addressTimeout);
            clearInterval(intervalMarketPolling);
            for (var marketPoll in xhrMarketGets){
                xhrMarketGets[marketPoll].abort();
            }
            if (xhrGetPayments) xhrGetPayments.abort();
        },
        init: function(){
        },
        update: function(){

            $('#networkLastBlockFound').timeago('update', new Date(lastStats.network.timestamp * 1000).toISOString());

            updateText('networkHashrate', getReadableHashRateString(lastStats.network.difficulty / lastStats.config.coinDifficultyTarget) + '/sec');
            updateText('networkDifficulty', lastStats.network.difficulty.toString());
            updateText('blockchainHeight', lastStats.network.height.toString());
            updateText('networkLastReward', getReadableCoins(lastStats.network.reward, 4));
            updateText('lastHash', lastStats.network.hash.substr(0, 13) + '...').setAttribute('href', getBlockchainUrl(lastStats.network.hash));

            updateText('poolHashrate', getReadableHashRateString(lastStats.pool.hashrate) + '/sec');

            if (lastStats.pool.lastBlockFound){
                var d = new Date(parseInt(lastStats.pool.lastBlockFound)).toISOString();
                $('#poolLastBlockFound').timeago('update', d);
            }
            else
                $('#poolLastBlockFound').removeAttr('title').data('ts', '').update('Never');

            //updateText('poolRoundHashes', lastStats.pool.roundHashes.toString());
            updateText('poolMiners', lastStats.pool.miners.toString());


            var totalFee = lastStats.config.fee;
            if (Object.keys(lastStats.config.donation).length) {
                var totalDonation = 0;
                for(var i in lastStats.config.donation) {
                    totalDonation += lastStats.config.donation[i];
                }
                totalFee += totalDonation;
                updateText('poolDonations', floatToString(totalDonation) + '% to open-source devs');
            }
            else{
                $('#donations').hide()
            }

            updateText('poolFee', /*floatToString(totalFee)*/ totalFee + '%');


            updateText('blockSolvedTime', getReadableTime(lastStats.network.difficulty / lastStats.pool.hashrate));
            updateText('calcHashSymbol', lastStats.config.symbol);

            calcEstimateProfit();
        }
    };


    $('#networkLastBlockFound,#poolLastBlockFound,#yourLastShare,#marketLastUpdated').timeago();

    function getReadableTime(seconds){

        var units = [ [60, 'second'], [60, 'minute'], [24, 'hour'],
            [7, 'day'], [4, 'week'], [12, 'month'], [1, 'year'] ];

        function formatAmounts(amount, unit){
            var rounded = Math.round(amount);
            return '' + rounded + ' ' + unit + (rounded > 1 ? 's' : '');
        }

        var amount = seconds;
        for (var i = 0; i < units.length; i++){
            if (amount < units[i][0])
                return formatAmounts(amount, units[i][1]);
            amount = amount / units[i][0];
        }
        return formatAmounts(amount,  units[units.length - 1][1]);
    }


    /* Market data polling */

    var intervalMarketPolling = setInterval(updateMarkets, 60000); //poll market data every 5 minutes
    var xhrMarketGets = {};
    updateMarkets();
    function updateMarkets(){
        $('#totalVolume').text('');

//      Create a cache
        $.getJSON('https://www.tradecrypto.click/API?v=markets&o=price&q=BBS%20BBST%20WBBS', function(data) {
//        $.getJSON('https://pool.bbscoin.xyz/crex24', function(data) {
//        $.getJSON('https://api.crex24.com/v2/public/orderBook?instrument=BBS-BTC', function(data) {
//		var ex=0;
//		while (data[ex]) {
		for (var ex=0; ex < data.length; ex++){
            		var data[data[ex]['eid'] + data[ex]['market']] = data[ex];
/*
		    $('#volume_'+ data[ex]['market'].tolower +'_'+ data[ex]['eid']).text(parseFloat(data[ex]['volume'] * data[ex]['price']).toFixed(8) + ' ' + data[ex]['market']);
		    $('#volume_usd_'+ data[ex]['eid']).text(parseFloat(data[ex]['price']).toFixed(11))
            	    increment(data[ex]['price']);
        	    $('.'+ data[ex]['eid']).removeClass('hidden');
	            $('#ticker').removeClass('hidden');
*/
//		ex++;
		}


	    // $('#volume_bbs_crex24').text(parseInt(bbs['QuoteVolume']).toLocaleString() + ' BBS');
            $('#volume_btc_crex24').text(parseFloat(data['crex24BTC']['volume'] * data['crex24BTC']['price']).toFixed(8) + ' BTC');
            $('#volume_usd_crex24').text(parseFloat(data['crex24BTC']['price']).toFixed(11))
            increment(data['crex24BTC']['price']);
            $('.crex24').removeClass('hidden');
            $('#ticker').removeClass('hidden');

	    $('#volume_trx_btrx').text(parseFloat(data['bololexTRX']['volume'] * data['bololexTRX']['price']).toFixed(8) + ' TRX');
            $('#volume_usd_btrx').text(parseFloat(data['bololexTRX']['price']).toFixed(8))
            increment(data['bololexTRX']['price']);
            $('.btrx').removeClass('hidden');
            $('#ticker').removeClass('hidden');

	    $('#volume_usdt_busdt').text(parseFloat(data['bololexUSDT']['volume'] * data['bololexUSDT']['price']).toFixed(8) + ' USDT');
            $('#volume_usd_busdt').text(parseFloat(data['bololexUSDT']['price']).toFixed(8))
            increment(data['bololexUSDT']['price']);
            $('.busdt').removeClass('hidden');
            $('#ticker').removeClass('hidden');

	    $('#volume_trx_wbbs').text(parseFloat(data['justswapTRX']['volume'] * data['justswapTRX']['price']).toFixed(6) + ' TRX');
            $('#volume_usd_wbbs').text(parseFloat(data['justswapTRX']['price']).toFixed(6))
            increment(data['justswapTRX']['price']);
            $('.wbbs').removeClass('hidden');
            $('#ticker').removeClass('hidden');

            $('#volume_btc_tradeogre').text(parseFloat(data['tradeogreBTC']['volume'] * data['tradeogreBTC']['price']).toFixed(8) + ' BTC');
            $('#volume_btcusd_tradeogre').text(parseFloat(data['tradeogreBTC']['price']).toFixed(8))
            increment(data['tradeogreBTC']['price']);
            $('.tradeogre-btc').removeClass('hidden');
            $('#ticker').removeClass('hidden');

            $('#volume_ltc_tradeogre').text(parseFloat(data['tradeogreLTC']['volume'] * data['tradeogreLTC']['price']).toFixed(8) + ' LTC');
            $('#volume_ltcusd_tradeogre').text(parseFloat(data['tradeogreLTC']['price']).toFixed(8))
            increment(data['tradeogreLTC']['price']);
            $('.tradeogre-ltc').removeClass('hidden');
            $('#ticker').removeClass('hidden');

        });

//      Create a 5 minute cache of tickers
/*
        $.getJSON('https://api.coinmarketcap.com/v2/ticker/', function(price) {
            var btcUsd = price.data['1']['quotes']['USD']['price'];
            var xmrUsd = price.data['328']['quotes']['USD']['price'];
            var ltcUsd = price.data['2']['quotes']['USD']['price'];
            var dogeUsd = price.data['74']['quotes']['USD']['price'];

            $.getJSON('https://tradeogre.com/api/v1/ticker/BTC-BBS', function(data) {
                var bbs = data.volume;
                $('#volume_btc_tradeogre').text(bbs + ' BTC');
                $('#volume_btcusd_tradeogre').text('$' + parseFloat(bbs * btcUsd).toFixed(2))
                increment(bbs * btcUsd);
                $('.tradeogre-btc').removeClass('hidden');
                $('#ticker').removeClass('hidden');
            });

            $.getJSON('https://tradeogre.com/api/v1/ticker/LTC-BBS', function(data) {
                var bbs = data.volume;
                $('#volume_ltc_tradeogre').text(bbs + ' LTC');
                $('#volume_ltcusd_tradeogre').text('$' + parseFloat(bbs * ltcUsd).toFixed(2))
                increment(bbs * ltcUsd);
                $('.tradeogre-ltc').removeClass('hidden');
                $('#ticker').removeClass('hidden');
            });

            $.getJSON('https://api.altex.exchange/v1/ticker', function(data) {
                var xmr = data.data.XMR_BBS;
                var btc = data.data.BTC_BBS;
                var ltc = data.data.LTC_BBS;
                var doge = data.data.DOGE_BBS;

                // $('#volume_xmrbbs_altex').text(parseInt(xmr.BBS).toLocaleString() + ' BBS');
                $('#volume_xmr_altex').text(xmr.XMR + ' XMR');
                $('#volume_xmrusd_altex').text('$' + parseFloat(xmr.XMR * xmrUsd).toFixed(2))
                increment(xmr.XMR * xmrUsd);
                $('.alex-xmr').removeClass('hidden');

                // $('#volume_btcbbs_altex').text(parseInt(btc.BBS).toLocaleString() + ' BBS');
                $('#volume_btc_altex').text(btc.BTC + ' BTC');
                $('#volume_btcusd_altex').text('$' + parseFloat(btc.BTC * btcUsd).toFixed(2))
                increment(btc.BTC * btcUsd);
                $('.alex-btc').removeClass('hidden');

                // $('#volume_ltcbbs_altex').text(parseInt(ltc.BBS).toLocaleString() + ' BBS');
                $('#volume_ltc_altex').text(ltc.LTC + ' LTC');
                $('#volume_ltcusd_altex').text('$' + parseFloat(ltc.LTC * ltcUsd).toFixed(2))
                increment(ltc.LTC * ltcUsd);
                $('.alex-ltc').removeClass('hidden');

                $('#volume_doge_altex').text(doge.DOGE + ' DOGE');
                $('#volume_dogeusd_altex').text('$' + parseFloat(doge.DOGE * dogeUsd).toFixed(2))
                increment(doge.DOGE * dogeUsd);
                $('.alex-doge').removeClass('hidden');

                $('#ticker').removeClass('hidden');
            });

        });
*/
    }

    function increment(num) {
        var sum = parseFloat($('#totalVolume').text() || '0');
        $('#totalVolume').html((sum + parseFloat(num)).toFixed(2));
    }

    /* Hash Profitability Calculator */

    $('#calcHashRate').keyup(calcEstimateProfit).change(calcEstimateProfit);

    $('#calcHashUnits > li > a').click(function(e){
        e.preventDefault();
        $('#calcHashUnit').text($(this).text()).data('mul', $(this).data('mul'));
        calcEstimateProfit();
    });

    function calcEstimateProfit(){
        try {
            var rateUnit = Math.pow(1024,parseInt($('#calcHashUnit').data('mul')));
            var hashRate = parseFloat($('#calcHashRate').val()) * rateUnit;
            var profit = (hashRate * 86400 / lastStats.network.difficulty) * lastStats.network.reward;
            if (profit) {
                updateText('calcHashAmount', getReadableCoins(profit, 2, true));
                return;
            }
        }
        catch(e){ }
        updateText('calcHashAmount', '');
    }

    /* Stats by mining address lookup */

    function getPaymentCells(payment){
        return '<td>' + formatDate(payment.time) + '</td>' +
                '<td>' + formatPaymentLink(payment.hash) + '</td>' +
                '<td>' + getReadableCoins(payment.amount, 4, true) + '</td>' +
                '<td>' + payment.mixin + '</td>';
    }

    var xhrAddressPoll;
    var addressTimeout;

    $('#lookUp').click(function(){

        var address = $('#yourStatsInput').val().trim();
        if (!address){
            $('#yourStatsInput').focus();
            return;
        }

        $('#addressError').hide();
        $('.yourStats').hide();
        $('#payments_rows').empty();

        $('#lookUp > span:first-child').hide();
        $('#lookUp > span:last-child').show();


        if (xhrAddressPoll) xhrAddressPoll.abort();
//        if (addressTimeout) clearTimeout(addressTimeout);

        function fetchAddressStats(longpoll){
            xhrAddressPoll = $.ajax({ // _address
                url: api + '/stats_address',
                data: {
                    address: address,
                    longpoll: longpoll
                },
                dataType: 'json',
                cache: 'false',
                success: function(data){                    

                    $('#lookUp > span:last-child').hide();
                    $('#lookUp > span:first-child').show();

                    if (!data.stats){
                        $('.yourStats, .userChart').hide();
                        $('#addressError').text(data.error).show();
/*
                        if (addressTimeout) clearTimeout(addressTimeout);
                        addressTimeout = setTimeout(function(){
                            fetchAddressStats(false);
                        }, 5000);
*/
//                        fetchAddressStats(false);
                        return;
                    }


                    $('#addressError').hide();

                    if (data.stats.lastShare)
                        $('#yourLastShare').timeago('update', new Date(parseInt(data.stats.lastShare) * 1000).toISOString());
                    else
                        updateText('yourLastShare', 'Never');

                    updateText('yourHashrateHolder', (data.stats.hashrate || '0 H') + '/sec');
                    updateText('yourHashes', (data.stats.hashes || 0).toString());
                    updateText('yourPaid', getReadableCoins(data.stats.paid));
                    updateText('yourPendingBalance', getReadableCoins(data.stats.balance));

                    renderPayments(data.payments);

                    $('.yourStats').show();

                    xhrRenderUserCharts = $.ajax({ // _address
                        url: api + '/stats_address?address=' + address + '&longpoll=false',            
                        cache: false,
                        dataType: 'json',            
                        success: function(data) {
                            createUserCharts(data);                                
                        }
                    });

                    docCookies.setItem('mining_address', address, Infinity);

//                    fetchAddressStats(true);
                },
                error: function(e){
                    if (e.statusText === 'abort') return;
                    $('#addressError').text('Connection error').show();

//                    if (addressTimeout) clearTimeout(addressTimeout);
//                    addressTimeout = setTimeout(function(){
//                    if (addressTimeout) clearInterval(addressTimeout);
//                    addressTimeout = 
//                    setInterval(function(){
//                        fetchAddressStats(false);
//                    }, 25000);

//                    fetchAddressStats(false);
                    
                }
            });
        }
//        setInterval(function(){ fetchAddressStats(false) }, 5000);
//        fetchAddressStats(false);

        if (addressTimeout) clearInterval(addressTimeout);

        addressTimeout = setInterval(function(){
                        fetchAddressStats(false);
        }, 5000);

    });
    
    var urlWalletAddress = location.search.split('wallet=')[1] || 0;

    var address = urlWalletAddress || docCookies.getItem('mining_address');

    var xhrRenderUserCharts;

    function createUserCharts(data) {
	    for(var chart in userGraphStat) {
		    if(data['charts'][chart] && data['charts'][chart].length) {
			    var graphData = getGraphData(data['charts'][chart], chart == 'payments');
			    userGraphStat[chart].tooltipValueLookups = {names: graphData.names};
			    $('[data-chart=user_' + chart + ']').show().find('.chart').sparkline(graphData.values, userGraphStat[chart]);
		    }
	    }
    }

    if (address){
        $('#yourStatsInput').val(address);
        $('#lookUp').click();
    }

    $('#yourStatsInput').keyup(function(e){
        if(e.keyCode === 13)
            $('#lookUp').click();
    });

    var xhrGetPayments;
    $('#loadMorePayments').click(function(){
        if (xhrGetPayments) xhrGetPayments.abort();
        xhrGetPayments = $.ajax({
            url: api + '/get_payments',
            data: {
                time: $('#payments_rows').children().last().data('time'),
                address: address
            },
            dataType: 'json',
            cache: 'false',
            success: function(data){
                renderPayments(data);
            }
        });
    });



    /* Show stats of the currency */

    function getGraphData (rawData, fixValueToCoins) {
        var graphData = {
            names: [],
            values: []
        };
        if(rawData) {
            for (var i = 0, xy; xy = rawData[i]; i++) {
                graphData.names.push(new Date(xy[0]*1000).toUTCString());
                graphData.values.push(fixValueToCoins ? getReadableCoins(xy[1], 4, true) : xy[1]);
            }
        }        
       
        
        return graphData;
    }

    function createCharts(data) {         
        if (data.hasOwnProperty("charts")) {
    	    var graphData = {
    		    profit: getGraphData(data.charts.profit),
    		    diff: getGraphData(data.charts.difficulty),
    		    hashrate: getGraphData(data.charts.hashrate),
    		    price: getGraphData(data.charts.price),
    		    workers: getGraphData(data.charts.workers)
    	    };
            
    	    for(var graphType in graphData) {
    		    if(graphData[graphType].values.length > 1) {
                    var settings = jQuery.extend({}, currencyGraphStat);
                    settings.tooltipValueLookups = {names: graphData[graphType].names};
			        var $chart = $('[data-chart=' + graphType + '] .chart');
			        $chart.closest('.chartWrap').show();
			        $chart.sparkline(graphData[graphType].values, settings);
    		    }
    	    }
        }
    }

    function loadStatistics () {        
        $.get(api + '/stats', function (stats) {
            if (stats) {
                showStats(stats)
            }
        });      
    }

    function showStats (stats) {
        $('#cur_diff').text(stats.network.difficulty);
        $('#cur_hashrate').text(getReadableHashRateString(stats.pool.hashrate) + '/s');
        $('#cur_workers').text(stats.pool.miners);        

        // Some values aren't available in stats.
        // Get the values from charts data.
        
        if (stats.hasOwnProperty('charts')) {
            var priceData = stats.charts.price;
            $('#cur_price').text(priceData ? priceData[priceData.length-1][1] : '---'); 
        }
        if (stats.hasOwnProperty('charts')) {
            var profitValue;
            var profitData = stats.charts.profit;

            if (profitData) {
                profitValue = profitData[profitData.length-1][1];
                if (profitValue) {
                    profitValue = profitValue.toPrecision(3).toString().replace(/(.*?)e(\+|\-)(\d+)/, '$1<sup>10<sup>$2$3</sup></sup>');
                }
                else {
                    profitValue = '---';
                }
            }
            else {
                profitValue = '---';
            }
            $('#cur_profit').html(profitValue);           
       }
    }



    
    var xhrRenderCharts;

    $(function(){
        xhrRenderCharts = $.ajax({
            url: api + '/stats',
            cache: false,            
            success: createCharts
        });               
    });



</script>
